services:
  espn4cc4c:
    # 2025.11.14 - local dev build with test endpoints in bin/vc_resolver.py
    # GitHub home for this project: https://github.com/kineticman/ESPN4CC4C
    # Docker container home for this project with setup instructions:
    #   https://github.com/kineticman/ESPN4CC4C/pkgs/container/espn4cc4c
    build: .
    image: ghcr.io/kineticman/espn4cc4c:${TAG:-localdev}
    container_name: espn4cc4c
    dns_search:
      - ${DOMAIN:-localdomain} # Change to the name of your LAN's domain, usually local or localdomain
      - ${TAILNET}             # Change to the name of your Tailnet, in the form tailxxxxx.ts.net
    ports:
      - ${PORT:-8094}:${PORT:-8094}
    environment:
      - TZ=${TZ:-America/New_York}
      - VC_RESOLVER_BASE_URL=${VC_RESOLVER_BASE_URL:-http://192.168.86.72:8094}
      - CC_HOST=${CC_HOST:-192.168.86.72}
      - CC_PORT=${CC_PORT:-5589}
      - PORT=${PORT:-8094}
      - APP_MODULE=${APP_MODULE:-bin.vc_resolver:app}
      - VALID_HOURS=${VALID_HOURS:-72}
      - LANES=${LANES:-40}
      - ALIGN=${ALIGN:-30}
      - MIN_GAP_MINS=${MIN_GAP_MINS:-30}
      - M3U_GROUP_TITLE=${M3U_GROUP_TITLE:-ESPN+ VC}
      - VC_M3U_PATH=${VC_M3U_PATH:-/app/out/playlist.m3u}
      - WATCH_API_KEY=${WATCH_API_KEY:-0dbf88e8-cc6d-41da-aa83-18b5c630bc5c}
    volumes:
      - ${HOST_DIR:-.}/data:/app/data
      - ${HOST_DIR:-.}/out:/app/out
      - ${HOST_DIR:-.}/logs:/app/logs
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:8094/health"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 60s
    restart: unless-stopped
