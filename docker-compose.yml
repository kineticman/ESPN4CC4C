services:
  espn4cc4c:
    # 2025.11.16 - mainline image; prebuilt on GHCR
    # GitHub home for this project: https://github.com/kineticman/ESPN4CC4C
    # Docker container home for this project with setup instructions:
    #   https://github.com/kineticman/ESPN4CC4C/pkgs/container/espn4cc4c
    # Uncomment `build: .` if you want to build locally instead of pulling GHCR.
    # build: .
    image: ghcr.io/kineticman/espn4cc4c:${TAG:-latest}
    container_name: espn4cc4c
    init: true                    # Proper signal handling for graceful shutdown
    stop_grace_period: 20s        # Allow time for cleanup before force-kill
    dns_search:
      - ${DOMAIN:-localdomain}    # Change to the name of your LAN's domain, usually local or localdomain
      - ${TAILNET}                # Change to the name of your Tailnet, in the form tailxxxxx.ts.net
    ports:
      - ${PORT:-8094}:${PORT:-8094}
    environment:
      - TZ=${TZ:-America/New_York}
      - VC_RESOLVER_BASE_URL=${VC_RESOLVER_BASE_URL:-http://192.168.86.72:8094}
      - CC_HOST=${CC_HOST:-192.168.86.72}
      - CC_PORT=${CC_PORT:-5589}
      # Optional: Channels-4-Chrome (CH4C) bridge for http:// playlists
      - CH4C_HOST=${CH4C_HOST:-127.0.0.1}
      - CH4C_PORT=${CH4C_PORT:-2442}
      - PORT=${PORT:-8094}
      - APP_MODULE=${APP_MODULE:-bin.vc_resolver:app}
      - VALID_HOURS=${VALID_HOURS:-72}
      - LANES=${LANES:-40}
      - ALIGN=${ALIGN:-30}
      - MIN_GAP_MINS=${MIN_GAP_MINS:-30}
      - M3U_GROUP_TITLE=${M3U_GROUP_TITLE:-ESPN+ VC}
      - VC_M3U_PATH=${VC_M3U_PATH:-/app/out/playlist.m3u}
      - WATCH_API_KEY=${WATCH_API_KEY:-0dbf88e8-cc6d-41da-aa83-18b5c630bc5c}
      
      # === EVENT FILTERING (Optional) ===
      # Uncomment any filters below to customize your content
      # For full documentation, see: https://github.com/kineticman/ESPN4CC4C#filtering
      
      # Network filtering examples:
      # - FILTER_EXCLUDE_NETWORKS=ACCN,ESPN,ESPN2,ESPNDeportes,ESPNU,ESPNEWS
      # - FILTER_ENABLED_NETWORKS=ESPN+,SEC Network,ACC Network
      
      # Sport filtering examples:
      # - FILTER_ENABLED_SPORTS=Football,Basketball,Baseball,Hockey
      # - FILTER_EXCLUDE_SPORTS=Golf,Tennis,Cricket
      
      # League filtering examples:
      # - FILTER_ENABLED_LEAGUES=NFL,NBA,MLB,NHL
      # - FILTER_ENABLED_LEAGUES=NCAA
      # - FILTER_EXCLUDE_LEAGUES=MLS,WNBA
      
      # ESPN+ and PPV filtering:
      # - FILTER_REQUIRE_ESPN_PLUS=true     # Only include ESPN+ content
      # - FILTER_EXCLUDE_PPV=true           # Exclude Pay-Per-View events
      # - FILTER_EXCLUDE_REAIR=true         # Exclude replays/re-airs
      # - FILTER_EXCLUDE_NO_SPORT=true      # Exclude studio shows/non-sport content
      
      # Language filtering:
      # - FILTER_ENABLED_LANGUAGES=en       # English only
      # - FILTER_EXCLUDE_LANGUAGES=es       # Exclude Spanish content
      
      # Advanced options:
      # - FILTER_CASE_INSENSITIVE=true      # Default: true
      # - FILTER_PARTIAL_LEAGUE_MATCH=true  # Default: true (NCAA matches NCAA Football, etc.)
      
    volumes:
      - ${HOST_DIR:-.}/data:/app/data
      - ${HOST_DIR:-.}/out:/app/out
      - ${HOST_DIR:-.}/logs:/app/logs
    healthcheck:
      test: ["CMD-SHELL", "curl -fsS http://localhost:${PORT:-8094}/health >/dev/null"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 60s
    logging:
      driver: "json-file"
      options:
        max-size: "10m"
        max-file: "5"
    restart: unless-stopped
